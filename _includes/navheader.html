<div class="date-picker-container">
  <label for="datePicker">Select a Date:</label>
  <input type="date" id="datePicker">
  <button onclick="loadEventsByDate()">Go</button>
</div>

<div class="filter-container">
  <label for="typeFilter">Filter by Type:</label>
  <select id="typeFilter">
    <option value="all">All Types</option>
    <option value="Politics">Politics</option>
    <option value="Science">Science</option>
    <option value="Sports">Sports</option>
    <option value="Economics">Economics</option>
    <option value="Technology">Technology</option>
    <option value="Military">Military</option>
    <option value="Culture">Culture</option>
  </select>
  <button onclick="filterEvents(); return false;">Apply Filter</button>
</div>

<div id="events-list" class="events-list">
  {% assign today = "now" | date: "%B %-d" %}
  {% assign todays_events = "" | split: "" %}

  {% for month in site.portfolio %}
    {% assign filtered_days = month.days | where: "date", today %}
    {% for day in filtered_days %}
      {% assign todays_events = todays_events | push: day %}
    {% endfor %}
  {% endfor %}
  
  <h2 class="events-date">Events on {{ today }} in History</h2>

  {% if todays_events.size > 0 %}
    {% for day in todays_events %}
      {% for year_events in day.years %}
        {% assign year = year_events[0] %}
        {% assign events = year_events[1].events %}

        {% for event in events %}
          <div class="event-item" data-type="{{ event.type }}">
            
            <strong class="event-year">{{ year }}</strong>
            <ul class="event-details">
              <li>
                <strong class="event-title">{{ event.title }}</strong>
                <p class="event-description">{{ event.description }}</p>
              </li>
            </ul>
          </div>
        {% endfor %}
      {% endfor %}
    {% endfor %}
  {% else %}
    <p class="no-events">No historical events found for today.</p>
  {% endif %}
</div>

<script>
  const allEvents = JSON.parse(document.getElementById("events-data").textContent);
  
  function loadEventsByDate() {
    const selectedDate = document.getElementById("datePicker").value;
    if (!selectedDate) {
      alert("Please select a date.");
      return;
    }

    const dateObj = new Date(selectedDate + "T00:00:00");
    const month = dateObj.toLocaleString('default', { month: 'long' }).toLowerCase();
    const day = dateObj.getUTCDate();

    // First, try the monthly file
    let url = `/portfolio/${month.toLowerCase()}/`;

    // Check if a daily file exists and update URL if found
    checkFileExists(`/days/${month}-${day}/`)
      .then(exists => {
        if (exists) {
          url = `/days/${month}-${day}/`;
        }
        window.location.href = url;
      })
      .catch(() => {
        alert("Error checking file existence.");
      });
  }

  function checkFileExists(url) {
    return fetch(url, { method: 'HEAD' })
      .then(response => response.ok)
      .catch(() => false);
  }
</script>
